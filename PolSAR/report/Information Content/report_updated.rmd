---
title: "Information Content in Color Images"
author: "Professor Alejando & Ulile"
date: "13/01/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introdução

As imagens coloridas contêm certas propriedades no espaço de cores CEILab. Tais imagens chamadas de "ideal" quando aplicadas técnicas extatisticas pode-se obter uma natureza de informações conhecidas por "maximum realizable color information" (MRCI).

Basicamente MRCI possui os dados distribuidos uniformemente no espaço CIELab. "A "não conformidade" com MRCI é uma medida de distância entre distribuições de imagens observada e a imagem MRCI".

A hipótese principal do presente trabalho consiste em avaliar qualidade da imagem ideal. Graças a diferentes métricas, pode-se medir distância entre distribuições dos dados duma imagem ideal e uma simulada. Uma das métricas mais utilizadas é a divergência de Kullback-Leibler e, consequentemente será utilizada.

Os autores obtêm uma versão empírica da imagem MRCI com os pontos amostrais distribuidos uniformemente no espaço CIELab $[L^*, a^*, b^*]$ limitado no intervalo $[0,100]\times [−200,200]\times [−200,200]$; os pontos válidos são mapeados no espaço $[R, G, B]$ no intervalo $[0, 1]^3$. Somente pontos válidos no espaço RGB são considerados.

## Etapas  
   
O trabalho divide-se em seguintes etapas:   
`* Selecão e preparação de imagens ideais;`     
`* Carregar imagens no ambiente;`   
`* Exploração dos dados;`   
`* Escolha de tamanho de bins;`   
`* Escolha de histograma;`   
`* ...`   
`* Aplicação de Kullback-Leibler;`   
``* ...``   

## Ensaios

Para o teste, escolheu-se três imagens, com duas referências que já foram usadas pelos autores. Tais imagens foram carregadas para o ambiente usandos a funcão $loadImage(...)$ do pacote [colordistance]([https://cran.r-project.org/web/packages/colordistance/vignettes/color-spaces.html]).

#### Carregamento
```{r echo=FALSE}
require(colordistance)
require(colorspace)
require(ggplot2)
require(plot3D)


# read the ideal "pauli"
img_lena <- loadImage("../../image/original/lena.png", 
                   CIELab = TRUE, sample.size = NULL, ref.white = "D65",
                   lower = NULL, upper = NULL)

#cria grade no intervalo especificados!
dataMESH <- mesh(seq(from=0, to=1, length.out=50),
                 seq(from=0, to=1, length.out=50),
                 seq(from=0, to=1, length.out=50))

rgb_ref <- data.frame(cbind(dataMESH$x, dataMESH$y, dataMESH$z))

img_ref <- matrix(c(dataMESH$x, dataMESH$y, dataMESH$z), ncol = 3)

names(rgb_ref) <- c("R", "G", "B")

#converte para espaco Lab usando a referência da luz D65.
lab_ref <- convertColorSpace(rgb_ref, from = "CIE RGB", 
                             to = "Lab", from.ref.white = NULL,
                             to.ref.white = "D65", sample.size = NULL)

#allpoints_ref <- cbind(lab_ref, rgb_ref)
```

Para ver a distribuição dos pontos no espaço "Lab", pode-se usar a função $plotPixels(...)$ do pacote colordistance.

#### Visualização dos pontos em CIELab
```{r echo=FALSE}
#show the ideal image histogram
plotPixels(img_lena, color.space = "lab",
           ref.white = "D65", from = "sRGB",
           main = "Pixel on CIElab space - lena",
           xlim = "default",
           ylim = "default",
           zlim = "default", 
           lower = NULL,
           upper = NULL)
```

O histograma em baixo nos mostra como os dados do componente L "Luminância" estão agrupados em cada uma das imagens.

**Faça novamente a figura abaixo, mostrando lado a lado a imagem e o histograma da sua componente L**

**Conclua esta seção exploratória mostrando a imagem "ideal" e o histograma da sua banda de luminância**

```{r echo=FALSE}
#getting the histogram of L component in each image

allpoints <- data.frame(cbind(img_lena$filtered.lab.2d, img_lena$filtered.rgb.2d))

par(mfrow = c(1, 2))
plotImage(img_lena)
title("Visualizacão da Lena")
hist(allpoints$L, breaks = "FD", xlab = "L",
                                 ylab = "Frequência",
     main = "Histograma do componente L")

# imagem de referência e a sua histograma. 
# a imagem de referência vista em subgrupos.
# os componentes da matrix estão nos intervalos x = [-.2, .2], y = (.2, .7), z = (.7, 1.2)
par(mfrow = c(1, 2))
image(img_ref, useRaster = TRUE,
      col = hcl.colors(11, "Spectral"),
      main = "Imagem de referência")

hist(lab_ref$L, breaks = "FD", xlab = "L",
                               ylab = "Frequência",
     main = "Histograma de componente L")


```

# Aplicação

A seguir veremos a aplicação da técnica proposta.

